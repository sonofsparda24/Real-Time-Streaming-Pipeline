@version: 3.35
@include "scl.conf"

###############################################################################
# 1. SOURCE — LISTEN FOR SYSLOG
###############################################################################

source s_network {
    udp(ip("0.0.0.0") port(5514));
    tcp(ip("0.0.0.0") port(6514));
};

###############################################################################
# 2. PARSER — PARSE SYSLOG
###############################################################################

parser p_syslog {
    syslog-parser();
};

###############################################################################
# 3. TEMPLATE — JSON OUTPUT (works for syslog-ng 3.x)
###############################################################################

template t_json {
    template("$(format-json --scope all-nv-pairs)\n");
};

###############################################################################
# 4. DESTINATION — KAFKA (syslog-ng 3.x syntax)
###############################################################################

destination d_kafka {
    kafka(
        bootstrap-servers("kafka:9092")
        topic("syslog_raw")
        message("$(format-json --scope all-nv-pairs)\n")
    );
};

###############################################################################
# 5. LOG PATH
###############################################################################

log {
    source(s_network);
    parser(p_syslog);
    destination(d_kafka);
};
